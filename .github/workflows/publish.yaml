name: Deploy website to GitHub Pages

env:
  WC_HUGO_VERSION: '0.123.3'  # ä½ çš„ Hugo ç‰ˆæœ¬

on:
  push:
    branches: ["main"]        # æ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯éƒ½ä¼šè§¦å‘éƒ¨ç½²
  workflow_dispatch:          # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

permissions:
  contents: write             # å…è®¸ GitHub Actions æ¨é€åˆ° main åˆ†æ”¯

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0       # è·å–å®Œæ•´ Git å†å²è®°å½•ï¼Œç¡®ä¿ .GitInfo æ­£å¸¸å·¥ä½œ

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: ${{ env.WC_HUGO_VERSION }}
          extended: true       # ä½¿ç”¨ Hugo æ‰©å±•ç‰ˆï¼ˆæ”¯æŒ SASS ç­‰åŠŸèƒ½ï¼‰

      - name: Build with Hugo
        run: hugo --minify -d docs  # Hugo æ„å»ºå¹¶å°†é™æ€æ–‡ä»¶è¾“å‡ºåˆ° docs æ–‡ä»¶å¤¹

      - name: Verify build output
        run: ls -la docs           # ç¡®è®¤ docs æ–‡ä»¶å¤¹å·²æ­£ç¡®ç”Ÿæˆå†…å®¹

      - name: Commit and Push to main branch
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add docs
          git commit -m "Deploy website to GitHub Pages ğŸš€" || echo "No changes to commit"
          git push origin main